---
title: "ç«‹ã¦æ›¿ãˆã®å–å¼•å›æ•°ã‚’æœ€å°é™ã«ã™ã‚‹tatekaeã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã—ã¾ã—ãŸï¼"
emoji: "ğŸˆ"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["go","react","SaaS"]
published: true
---

# èƒŒæ™¯
åƒ•ã‚’å«ã‚ãŸå‹é”ã§ã‚ˆãæ—…è¡Œã«è¡Œãã®ã§ã™ãŒã€æ—…è¡Œã«ä»˜ãã¾ã¨ã†ã®ã¯ä»£é‡‘ã®ç«‹ã¦æ›¿ãˆã ã¨æ€ã„ã¾ã™ã€‚
é£›è¡Œæ©Ÿä»£ã‚’å»ºã¦æ›¿ãˆãŸã‚Šã€å±…é…’å±‹ä»£ã‚’å»ºã¦æ›¿ãˆãŸã‚Šã¨è‰²ã€…ç«‹ã¦æ›¿ãˆã‚‹ã“ã¨ãŒå¤šã„ã§ã™ãŒã€å¿…ãšã—ã‚‚ä¸€äººãŒå»ºã¦æ›¿ãˆç¶šã‘ã‚‹ã“ã¨ã¯å°‘ãªã„ã¨æ€ã„ã¾ã™ã€‚
ã¾ãŸå€‹ã€…ã«å»ºã¦æ›¿ãˆãŸã‚Šã¨ã€æ—…è¡Œã®ãŸã³ã«è«‹æ±‚ã—ãŸã‚Šã•ã‚ŒãŸã‚Šã§é¢å€’ã ã£ãŸã®ã§ã€ä½œæˆã«è‡³ã‚Šã¾ã—ãŸã€‚

repository:
    https://github.com/ei-sugimoto/tatekae
# ä½¿ã„æ–¹

ç«‹ã¦æ›¿ãˆã®å–å¼•ã‚’ä»–äººè¦‹ã‚‰ã‚Œã¦ã‚‚å•é¡Œãªã„äººã‚„ãƒ‡ãƒ¢ã‚’è¦‹ã¦ã¿ãŸã„äººã¯ã€ä¸‹è¨˜ã®URL(è‡ªå®…ã‚µãƒ¼ãƒ)ã«å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚æ™‚ã€…é–‰ã˜ã¦ã„ãŸã‚Šã™ã‚‹ã®ã§ã€æ³¨æ„ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚
https://tatekae-web.ei-sugimoto.uk/

## èµ·å‹•æ–¹æ³•
k8sãªã©ã«3ã¤ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¾ã™ã€‚dbã¯ã€mysqlã®imageã‚’ä½¿ç”¨ã—ã€apiã¨webã¯ghcrã‹ã‚‰å–å¾—ã—ã¦ãã ã•ã„ã€‚
- docker compose
```yaml:docker-compose.yml
services:
  db:
    image: mysql:8.1
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: mydb
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    ports:
      - "3306:3306"
    volumes:
      - db:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 5s
      timeout: 5s
      retries: 5

  api:
    image: ghcr.io/ei-sugimoto/tatekae/api:latest
    ports:
      - "8080:8080"
    environment:
      - DB_HOST=db
      - DB_USER=user
      - DB_PASS=password
      - DB_NAME=mydb
      - DB_PORT=3306
    depends_on:
      db:
        condition: service_healthy
    tty: true

  web:
    image: ghcr.io/ei-sugimoto/tatekae/api:latest
    ports:
      - "3000:80"
    depends_on:
      - api
      - db
    tty: true
    working_dir: /workspace/app
    stdin_open: true
```
- k8s
```yaml:tatekae-deploy.yml
apiVersion: v1
kind: Namespace
metadata:
  name: tatekae

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: db-pvc
  namespace: tatekae
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi

---
apiVersion: v1
kind: Service
metadata:
  name: db
  namespace: tatekae
spec:
  ports:
    - port: 3306
  selector:
    app: db

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: db
  namespace: tatekae
spec:
  replicas: 1
  selector:
    matchLabels:
      app: db
  template:
    metadata:
      labels:
        app: db
    spec:
      containers:
        - name: db
          image: mysql:8.1
          ports:
            - containerPort: 3306
          env:
            - name: MYSQL_ROOT_PASSWORD
              value: 'rootpassword'
            - name: MYSQL_DATABASE
              value: 'mydb'
            - name: MYSQL_USER
              value: 'user'
            - name: MYSQL_PASSWORD
              value: 'password'
          volumeMounts:
            - name: db-storage
              mountPath: /var/lib/mysql
      volumes:
        - name: db-storage
          persistentVolumeClaim:
            claimName: db-pvc

---
apiVersion: v1
kind: Service
metadata:
  name: api
  namespace: tatekae
spec:
  ports:
    - port: 8080
  selector:
    app: api

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api
  namespace: tatekae
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api
  template:
    metadata:
      labels:
        app: api
    spec:
      containers:
        - name: api
          image: ghcr.io/ei-sugimoto/tatekae/api:latest
          ports:
            - containerPort: 8080
          env:
            - name: DB_HOST
              value: 'db'
            - name: DB_USER
              value: 'user'
            - name: DB_PASS
              value: 'password'
            - name: DB_NAME
              value: 'mydb'
            - name: DB_PORT
              value: '3306'
          volumeMounts:
            - name: api-storage
              mountPath: /app
      volumes:
        - name: api-storage
          emptyDir: {}

---
apiVersion: v1
kind: Service
metadata:
  name: web
  namespace: tatekae
spec:
  ports:
    - port: 3000
      targetPort: 80
  selector:
    app: web

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web
  namespace: tatekae
spec:
  replicas: 1
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
        - name: web
          image: ghcr.io/ei-sugimoto/tatekae/web:latest
          ports:
            - containerPort: 80
          volumeMounts:
            - name: web-storage
              mountPath: /workspace/app
      volumes:
        - name: web-storage
          emptyDir: {}
```

## ã‚µã‚¤ãƒˆå†…èª¬æ˜

1. ãƒ¦ãƒ¼ã‚¶ã«ãƒ­ã‚°ã‚¤ãƒ³ã¾ãŸã¯ç™»éŒ²
ã¾ãšã¯ã€ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã¾ãŸã¯ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã—ã¾ã—ã‚‡ã†ï¼
![login](https://storage.googleapis.com/zenn-user-upload/1ffbc42c779a-20240926.png)
1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆãŠã‚ˆã³å‚åŠ 
æ—…è¡Œæ¯ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼ä½œæˆã—ãŸã‚‰ã€Joinãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚
![join](https://storage.googleapis.com/zenn-user-upload/e62ecf00509d-20240926.png)
1. è«‹æ±‚ã‚’ä½œæˆã™ã‚‹
![bill](https://storage.googleapis.com/zenn-user-upload/5494c91fb6f1-20240926.png)

èµ¤ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã€é’ãŒå‚åŠ ã—ã¦ã„ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ã€é»„ãŒè«‹æ±‚ã‚’ä½œæˆã™ã‚‹ã¨ã“ã‚ã§ã™ã€‚
![create](https://storage.googleapis.com/zenn-user-upload/ed52225d7c48-20240926.png)
å‚åŠ ã—ã¦ã„ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ãŒè«‹æ±‚å…ˆä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€å»ºã¦æ›¿ãˆãŸé‡‘é¡ã‚’å…¥åŠ›ã—ã€è«‹æ±‚å…ˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼
![list](https://storage.googleapis.com/zenn-user-upload/d699c603deb6-20240926.png)
ä½œæˆãŒå®Œäº†ã™ã‚‹ã¨ã€ä½œæˆã—ãŸè«‹æ±‚ã®ä¸€è¦§ã¨ã€å–å¼•å›æ•°ã‚’æœ€å°é™ã—ãŸçµæœã‚’ç¤ºã™summarizeãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

# æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
## api
1. ent
entã‚’ä½¿ç”¨ã—ã¦schemaã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€SQLã«å‹ã®æ³¨é‡ˆãŒã¤ãã®ã§éå¸¸ã«ç°¡å˜ã§ã™ã€‚
2. connect-go
gprcé€šä¿¡ãŠã‚ˆã³webã‹ã‚‰ã®httpé€šä¿¡ã®ä¸¡æ–¹ã«å¯¾å¿œã§ãã€protobufã§ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚„ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å®šç¾©ã§ãã‚‹connectã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆç­‰ã«ã‚‚å‹ã®æ³¨é‡ˆãŒã¤ãã®ã§ã€æ¥½ã«é–‹ç™ºã§ãã¾ã—ãŸã€‚
# web
1. vite+react
ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦viteã€ã¾ãŸç´”ç²‹ãªreactã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚vueã¨reactã¯è¿·ã„ã¾ã—ãŸãŒã€æœ€è¿‘ä½¿ã£ã¦ã„ã‚‹reactã‚’é¸ã³ã¾ã—ãŸã€‚

# other
1. **cloudflared tunnel**
ã‚µã‚¯ãƒƒã¨è‡ªå®…ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã‚‚tunnelã‚’ä½œæˆã—ã¦ã€è‡ªå®…ã‚µãƒ¼ãƒã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚ã“ã®tunnelè‡ªä½“ã‚‚ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã“ã¨ã§ç°¡å˜ã«ä½œæˆã§ãã‚‹ã®ã§ã¾ã˜ã§ä¾¿åˆ©ã§ã™ï¼ï¼

# ä»Šå¾Œè¿½åŠ ã—ã¦ã„ããŸã„æ©Ÿèƒ½
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’publicã‹privateã‹ã‚’é¸ã¹ã‚‹
ç¾çŠ¶ã§ã¯ã€ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€æ‹›å¾…åˆ¶ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚ä½œæˆã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ããŸã„ã§ã™ã€‚
- UIã‚’ä½œã‚Šã“ã‚€
ã¾ã ã€1é€±é–“ç¨‹åº¦ã—ã‹é–‹ç™ºã—ã¦ã„ãªã„ã®ã§ã€UIãŒå¾®å¦™ã§ã™ã€‚ã“ã“ã¯å°‘ã—ãšã¤ä½œã‚Šã“ã‚“ã§ã„ããŸã„ã€‚